{% extends 'industry_base.html' %}
{% set active = 'reports' %}
{% set title = 'Reports & Compliance - BlueCarbon' %}
{% set header = 'Reports & Compliance' %}
{% set subheader = 'Download sustainability reports and compliance certificates' %}

{% block header_actions %}
<div style="display: flex; gap: 0.75rem; align-items: center;">
    <select style="padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px;" id="reportYear">
        <option value="2024">2024 Reports</option>
        <option value="2023">2023 Reports</option>
        <option value="2022">2022 Reports</option>
    </select>
    <button class="btn btn-primary" onclick="generateAnnualReport()">
        <i class="fas fa-file-pdf"></i>
        Generate Annual Report
    </button>
</div>
{% endblock %}

{% block content %}
<!-- Report Summary Cards -->
<div class="stats-grid" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 2rem;">
    <div class="stat-card" style="border-top: 4px solid var(--success);">
        <div class="stat-value" style="color: var(--success);">{{ "{:,}".format(purchases|length) }}</div>
        <div class="stat-label">
            <i class="fas fa-file-alt"></i>
            Available Reports
        </div>
        <div class="stat-change">
            Ready for download
        </div>
    </div>
    
    <div class="stat-card" style="border-top: 4px solid var(--primary);">
        <div class="stat-value" style="color: var(--primary);">{{ "{:,}".format(company.credits_purchased) }}</div>
        <div class="stat-label">
            <i class="fas fa-certificate"></i>
            Credits Certified
        </div>
        <div class="stat-change">
            Blockchain verified
        </div>
    </div>
    
    <div class="stat-card" style="border-top: 4px solid var(--warning);">
        <div class="stat-value" style="color: var(--warning);">{{ ((company.credits_retired / company.annual_emissions * 100)|round(1)) if company.annual_emissions > 0 else 0 }}%</div>
        <div class="stat-label">
            <i class="fas fa-calculator"></i>
            Carbon Offset Achieved
        </div>
        <div class="stat-change">
            Compliance ready
        </div>
    </div>
    
    <div class="stat-card" style="border-top: 4px solid var(--info);">
        <div class="stat-value" style="color: var(--info);">A+</div>
        <div class="stat-label">
            <i class="fas fa-award"></i>
            Sustainability Grade
        </div>
        <div class="stat-change">
            Based on ESG metrics
        </div>
    </div>
</div>

<!-- Main Content Grid -->
<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
    <!-- Left Column - Reports -->
    <div>
        <!-- Sustainability Reports -->
        <div class="card" style="margin-bottom: 2rem;">
            <div class="card-header">
                <h3><i class="fas fa-chart-pie"></i> Sustainability Reports</h3>
            </div>
            <div class="card-body">
                <div style="display: grid; gap: 1.5rem;">
                    <!-- Annual Sustainability Report -->
                    <div style="display: flex; align-items: center; gap: 1rem; padding: 1.5rem; border: 1px solid var(--border); border-radius: 8px; transition: box-shadow 0.2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow=''">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--success), #22c55e); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--dark);">Annual Sustainability Report 2024</h4>
                            <p style="margin: 0 0 0.5rem 0; color: var(--text-muted); font-size: 0.875rem;">
                                Comprehensive ESG performance, carbon footprint analysis, and sustainability initiatives
                            </p>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">
                                <span>Generated: {{ company.registration_date.strftime('%d %b %Y') if company.registration_date else 'Dec 31, 2024' }}</span> • 
                                <span>Pages: 24</span> • 
                                <span>Size: 2.4 MB</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-primary" onclick="downloadReport('annual-sustainability')">
                                <i class="fas fa-download"></i>
                                Download PDF
                            </button>
                            <button class="btn btn-outline" onclick="previewReport('annual-sustainability')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Carbon Footprint Report -->
                    <div style="display: flex; align-items: center; gap: 1rem; padding: 1.5rem; border: 1px solid var(--border); border-radius: 8px; transition: box-shadow 0.2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow=''">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary), #3b82f6); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--dark);">Carbon Footprint Assessment</h4>
                            <p style="margin: 0 0 0.5rem 0; color: var(--text-muted); font-size: 0.875rem;">
                                Detailed emissions analysis, reduction targets, and offset performance metrics
                            </p>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">
                                <span>Updated: Weekly</span> • 
                                <span>Pages: 12</span> • 
                                <span>Size: 1.8 MB</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-primary" onclick="downloadReport('carbon-footprint')">
                                <i class="fas fa-download"></i>
                                Download PDF
                            </button>
                            <button class="btn btn-outline" onclick="previewReport('carbon-footprint')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Transaction Audit Report -->
                    <div style="display: flex; align-items: center; gap: 1rem; padding: 1.5rem; border: 1px solid var(--border); border-radius: 8px; transition: box-shadow 0.2s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow=''">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--warning), #f59e0b); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div style="flex: 1;">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--dark);">Transaction Audit Trail</h4>
                            <p style="margin: 0 0 0.5rem 0; color: var(--text-muted); font-size: 0.875rem;">
                                Complete transaction history with blockchain verification for audit purposes
                            </p>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">
                                <span>Transactions: {{ purchases|length }}</span> • 
                                <span>Pages: 8</span> • 
                                <span>Size: 1.2 MB</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-primary" onclick="downloadReport('transaction-audit')">
                                <i class="fas fa-download"></i>
                                Download PDF
                            </button>
                            <button class="btn btn-outline" onclick="previewReport('transaction-audit')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compliance Certificates -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-certificate"></i> Compliance Certificates</h3>
            </div>
            <div class="card-body">
                <div style="display: grid; gap: 1rem;">
                    {% for purchase in purchases %}
                    <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; border: 1px solid var(--border); border-radius: 8px;">
                        <div style="width: 40px; height: 40px; background: {{ 'var(--success)' if purchase.status == 'Retired' else 'var(--primary)' }}; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white;">
                            <i class="fas fa-certificate"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--dark); margin-bottom: 0.25rem;">
                                {{ purchase.project_name }} Certificate
                            </div>
                            <div style="font-size: 0.875rem; color: var(--text-muted);">
                                {{ purchase.credits_purchased }} tCO₂e • {{ purchase.purchase_date.strftime('%d %b %Y') }}
                                {% if purchase.status == 'Retired' %} • <span style="color: var(--success);">Offset Applied</span>{% endif %}
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-outline" style="font-size: 0.875rem;" onclick="downloadCertificate('{{ purchase.transaction_id }}')">
                                <i class="fas fa-download"></i>
                                Certificate
                            </button>
                            <button class="btn btn-outline" style="font-size: 0.875rem;" onclick="viewBlockchain('{{ purchase.blockchain_hash }}')">
                                <i class="fas fa-link"></i>
                                Blockchain
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column - Quick Actions & Verification -->
    <div>
        <!-- Verification Status -->
        <div class="card" style="margin-bottom: 2rem;">
            <div class="card-header">
                <h3><i class="fas fa-shield-alt"></i> Verification Status</h3>
            </div>
            <div class="card-body">
                <div style="text-align: center; margin-bottom: 1.5rem;">
                    <div style="width: 80px; height: 80px; margin: 0 auto 1rem; background: var(--success); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem;">
                        <i class="fas fa-check-shield"></i>
                    </div>
                    <h4 style="margin: 0 0 0.5rem 0; color: var(--success);">Fully Verified</h4>
                    <p style="margin: 0; color: var(--text-muted); font-size: 0.875rem;">
                        All reports and certificates are blockchain-verified and audit-ready
                    </p>
                </div>
                
                <div style="padding: 1rem; background: #f0fdf4; border-radius: 8px; border-left: 4px solid var(--success);">
                    <div style="font-weight: 600; color: #166534; margin-bottom: 0.5rem;">
                        <i class="fas fa-check-circle"></i> Compliance Ready
                    </div>
                    <ul style="margin: 0; padding-left: 1.5rem; color: #166534; font-size: 0.875rem;">
                        <li>ESG Reporting Standards</li>
                        <li>Carbon Accounting Protocols</li>
                        <li>Blockchain Verification</li>
                        <li>Audit Trail Documentation</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Sharing Options -->
        <div class="card" style="margin-bottom: 2rem;">
            <div class="card-header">
                <h3><i class="fas fa-share-alt"></i> Share Achievements</h3>
            </div>
            <div class="card-body">
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="font-size: 1rem; margin-bottom: 0.5rem;">Sustainability Badge</h4>
                    <div style="text-align: center; padding: 1.5rem; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 8px; margin-bottom: 1rem;">
                        <div style="width: 60px; height: 60px; margin: 0 auto 0.5rem; background: var(--success); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                            <i class="fas fa-leaf"></i>
                        </div>
                        <div style="font-weight: 600; color: var(--dark);">{{ company.company_name }}</div>
                        <div style="font-size: 0.875rem; color: var(--success);">
                            {{ "{:,}".format(company.credits_retired) }} tCO₂e Offset
                        </div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">Verified by BlueCarbon</div>
                    </div>
                </div>
                
                <div style="display: grid; gap: 0.5rem;">
                    <button class="btn btn-outline" onclick="shareOnLinkedIn()">
                        <i class="fab fa-linkedin"></i>
                        Share on LinkedIn
                    </button>
                    <button class="btn btn-outline" onclick="shareOnTwitter()">
                        <i class="fab fa-twitter"></i>
                        Share on Twitter
                    </button>
                    <button class="btn btn-outline" onclick="downloadBadge()">
                        <i class="fas fa-download"></i>
                        Download Badge
                    </button>
                </div>
            </div>
        </div>

        <!-- Report Schedule -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-calendar-alt"></i> Report Schedule</h3>
            </div>
            <div class="card-body">
                <div style="display: grid; gap: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; font-size: 0.875rem;">Monthly Report</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Next: Jan 1, 2025</div>
                        </div>
                        <span class="badge badge-info">Scheduled</span>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; font-size: 0.875rem;">Quarterly ESG</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Next: Mar 31, 2025</div>
                        </div>
                        <span class="badge badge-warning">Pending</span>
                    </div>
                    
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 600; font-size: 0.875rem;">Annual Report</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Next: Dec 31, 2025</div>
                        </div>
                        <span class="badge badge-success">Ready</span>
                    </div>
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <button class="btn btn-primary" style="width: 100%;" onclick="configureSchedule()">
                        <i class="fas fa-cog"></i>
                        Configure Schedule
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Report Preview Modal -->
<div id="reportModal" class="modal">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h3 id="reportModalTitle"><i class="fas fa-file-alt"></i> Report Preview</h3>
            <span class="close" onclick="closeReportModal()">&times;</span>
        </div>
        <div class="modal-body">
            <div id="reportPreviewContent">
                <!-- Report preview content will be loaded here -->
            </div>
        </div>
    </div>
</div>

<script>
function downloadReport(reportType) {
    showNotification(`Downloading ${reportType.replace('-', ' ')} report...`, 'info');
    
    // In a real implementation, this would trigger the actual download
    setTimeout(() => {
        showNotification('Report downloaded successfully!', 'success');
    }, 1500);
}

function previewReport(reportType) {
    let title, content;
    
    switch(reportType) {
        case 'annual-sustainability':
            title = 'Annual Sustainability Report 2024';
            content = generateAnnualReportPreview();
            break;
        case 'carbon-footprint':
            title = 'Carbon Footprint Assessment';
            content = generateCarbonFootprintPreview();
            break;
        case 'transaction-audit':
            title = 'Transaction Audit Trail';
            content = generateAuditTrailPreview();
            break;
    }
    
    document.getElementById('reportModalTitle').innerHTML = `<i class="fas fa-file-alt"></i> ${title}`;
    document.getElementById('reportPreviewContent').innerHTML = content;
    document.getElementById('reportModal').style.display = 'flex';
}

function generateAnnualReportPreview() {
    return `
        <div style="max-height: 60vh; overflow-y: auto; padding: 1rem;">
            <div style="text-align: center; margin-bottom: 2rem; padding: 2rem; background: linear-gradient(135deg, #f0f9ff, #e0f2fe); border-radius: 8px;">
                <h2 style="margin: 0 0 0.5rem 0; color: var(--primary);">Annual Sustainability Report</h2>
                <p style="margin: 0; color: var(--text-muted);">{{ company.company_name if company.company_name else 'EcoTech Industries Ltd' }} • Year 2024</p>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--dark); margin-bottom: 1rem;">Executive Summary</h3>
                <p style="margin-bottom: 1rem; color: var(--text-muted);">
                    In 2024, our organization has made significant strides in environmental sustainability through strategic 
                    carbon credit investments and operational improvements. We have successfully offset 
                    {{ ((company.credits_retired / company.annual_emissions * 100)|round(1)) if company.annual_emissions > 0 else 0 }}% 
                    of our carbon footprint through verified blue carbon projects.
                </p>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin: 2rem 0;">
                    <div style="text-align: center; padding: 1rem; background: #f0fdf4; border-radius: 8px;">
                        <div style="font-size: 2rem; font-weight: bold; color: var(--success);">${{ "{:,}".format(company.credits_purchased) }}</div>
                        <div style="font-size: 0.875rem; color: var(--text-muted);">Credits Purchased (tCO₂e)</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: #f0f9ff; border-radius: 8px;">
                        <div style="font-size: 2rem; font-weight: bold; color: var(--primary);">₹{{ "{:,}".format(company.total_spent) }}</div>
                        <div style="font-size: 0.875rem; color: var(--text-muted);">Environmental Investment</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: #fffbeb; border-radius: 8px;">
                        <div style="font-size: 2rem; font-weight: bold; color: var(--warning);">{{ purchases|length }}</div>
                        <div style="font-size: 0.875rem; color: var(--text-muted);">Projects Supported</div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-primary" onclick="downloadReport('annual-sustainability')">
                    <i class="fas fa-download"></i>
                    Download Full Report (24 pages)
                </button>
            </div>
        </div>
    `;
}

function generateCarbonFootprintPreview() {
    return `
        <div style="max-height: 60vh; overflow-y: auto; padding: 1rem;">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h2 style="margin: 0 0 0.5rem 0; color: var(--primary);">Carbon Footprint Assessment</h2>
                <p style="margin: 0; color: var(--text-muted);">Comprehensive emissions analysis and reduction strategy</p>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--dark); margin-bottom: 1rem;">Emissions Overview</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <h4>Current Status</h4>
                        <p>Annual Emissions: <strong>{{ "{:,}".format(company.annual_emissions) }} tCO₂e</strong></p>
                        <p>Credits Retired: <strong>{{ "{:,}".format(company.credits_retired) }} tCO₂e</strong></p>
                        <p>Offset Percentage: <strong>{{ ((company.credits_retired / company.annual_emissions * 100)|round(1)) if company.annual_emissions > 0 else 0 }}%</strong></p>
                    </div>
                    <div>
                        <h4>Reduction Targets</h4>
                        <p>2025 Goal: <strong>50% Offset</strong></p>
                        <p>2027 Goal: <strong>80% Offset</strong></p>
                        <p>2030 Goal: <strong>Net Zero</strong></p>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-primary" onclick="downloadReport('carbon-footprint')">
                    <i class="fas fa-download"></i>
                    Download Full Assessment (12 pages)
                </button>
            </div>
        </div>
    `;
}

function generateAuditTrailPreview() {
    return `
        <div style="max-height: 60vh; overflow-y: auto; padding: 1rem;">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h2 style="margin: 0 0 0.5rem 0; color: var(--primary);">Transaction Audit Trail</h2>
                <p style="margin: 0; color: var(--text-muted);">Complete blockchain-verified transaction history</p>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--dark); margin-bottom: 1rem;">Recent Transactions</h3>
                <div style="border: 1px solid var(--border); border-radius: 8px; overflow: hidden;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead style="background: var(--light);">
                            <tr>
                                <th style="padding: 0.5rem; text-align: left; font-size: 0.875rem;">Transaction ID</th>
                                <th style="padding: 0.5rem; text-align: left; font-size: 0.875rem;">Credits</th>
                                <th style="padding: 0.5rem; text-align: left; font-size: 0.875rem;">Amount</th>
                                <th style="padding: 0.5rem; text-align: left; font-size: 0.875rem;">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for purchase in purchases[:5] %}
                            <tr>
                                <td style="padding: 0.5rem; font-size: 0.75rem; font-family: monospace;">{{ purchase.transaction_id }}</td>
                                <td style="padding: 0.5rem; font-size: 0.875rem;">{{ purchase.credits_purchased }} tCO₂e</td>
                                <td style="padding: 0.5rem; font-size: 0.875rem;">₹{{ "{:,}".format(purchase.total_paid) }}</td>
                                <td style="padding: 0.5rem;">
                                    <span class="badge badge-{{ 'success' if purchase.status == 'Active' else 'warning' }}" style="font-size: 0.75rem;">
                                        {{ purchase.status }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-primary" onclick="downloadReport('transaction-audit')">
                    <i class="fas fa-download"></i>
                    Download Complete Audit Trail (8 pages)
                </button>
            </div>
        </div>
    `;
}

function closeReportModal() {
    document.getElementById('reportModal').style.display = 'none';
}

function downloadCertificate(transactionId) {
    showNotification(`Downloading certificate for transaction ${transactionId}...`, 'info');
    // Certificate download logic would go here
    setTimeout(() => {
        showNotification('Certificate downloaded successfully!', 'success');
    }, 1000);
}

function viewBlockchain(hash) {
    showNotification('Opening blockchain explorer...', 'info');
    // In production, this would open the actual blockchain explorer
    setTimeout(() => {
        alert(`Blockchain Hash: ${hash}\n\nThis would open the blockchain explorer in production.`);
    }, 500);
}

function generateAnnualReport() {
    const year = document.getElementById('reportYear').value;
    showNotification(`Generating comprehensive annual report for ${year}...`, 'info');
    
    setTimeout(() => {
        showNotification(`${year} Annual Report generated successfully!`, 'success');
    }, 2000);
}

function shareOnLinkedIn() {
    const text = `Proud to announce that {{ company.company_name if company.company_name else 'our company' }} has offset {{ "{:,}".format(company.credits_retired) }} tCO₂e through verified blue carbon projects! 🌱 #Sustainability #CarbonNeutral #BlueCarbon`;
    showNotification('Sharing on LinkedIn...', 'info');
}

function shareOnTwitter() {
    const text = `🌍 {{ company.company_name if company.company_name else 'Our company' }} achieved {{ ((company.credits_retired / company.annual_emissions * 100)|round(1)) if company.annual_emissions > 0 else 0 }}% carbon offset through #BlueCarbon projects! Supporting marine ecosystems while fighting climate change. #Sustainability #CarbonOffset`;
    showNotification('Sharing on Twitter...', 'info');
}

function downloadBadge() {
    showNotification('Downloading sustainability badge...', 'info');
    setTimeout(() => {
        showNotification('Badge downloaded successfully!', 'success');
    }, 1000);
}

function configureSchedule() {
    showNotification('Report scheduling feature coming soon!', 'info');
}

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    console.log('Reports page loaded');
});
</script>
{% endblock %}